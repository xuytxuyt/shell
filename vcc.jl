using ApproxOperator, Tensors
import BenchmarkExample: BenchmarkExample

include("import_vcc.jl")


elements, nodes = import_vcc("msh/scordelislo_16.msh")
cs = BenchmarkExample.cylindricalCoordinate(25.0)
# elements, nodes = import_vcc("msh/sphericalshell_1.msh")
# cs = BenchmarkExample.sphericalCoordinate(10.0)


ğ’‚â‚ = cs.ğ’‚â‚
ğ’‚â‚‚ = cs.ğ’‚â‚‚
ğ’‚â‚ƒ = cs.ğ’‚â‚ƒ
ğ’‚Â¹ = cs.ğ’‚Â¹
ğ’‚Â² = cs.ğ’‚Â²
ğ’‚Â³ = cs.ğ’‚Â³
Î“Â¹â‚â‚ = cs.Î“Â¹â‚â‚
Î“Â¹â‚â‚‚ = cs.Î“Â¹â‚â‚‚
Î“Â²â‚‚â‚ = cs.Î“Â²â‚â‚‚
Î“Â²â‚‚â‚‚ = cs.Î“Â²â‚‚â‚‚
Î“Â¹â‚â‚â‚ = cs.âˆ‚â‚Î“Â¹â‚â‚
Î“Â¹â‚â‚â‚‚ = cs.âˆ‚â‚‚Î“Â¹â‚â‚
Î“Â¹â‚â‚‚â‚ = cs.âˆ‚â‚Î“Â¹â‚â‚‚
Î“Â¹â‚â‚‚â‚‚ = cs.âˆ‚â‚‚Î“Â¹â‚â‚‚
Î“Â²â‚‚â‚â‚ = cs.âˆ‚â‚Î“Â²â‚â‚‚
Î“Â²â‚‚â‚â‚‚ = cs.âˆ‚â‚‚Î“Â²â‚â‚‚
Î“Â²â‚‚â‚‚â‚ = cs.âˆ‚â‚Î“Â²â‚‚â‚‚
Î“Â²â‚‚â‚‚â‚‚ = cs.âˆ‚â‚‚Î“Â²â‚‚â‚‚
ğ½ = cs.ğ½

# ğ’‚â‚(x) = Vec{3}((1.0,0.0,0.0))
# ğ’‚â‚‚(x) = Vec{3}((0.0,1.0,0.0))
# ğ’‚â‚ƒ(x) = Vec{3}((0.0,0.0,1.0))
# ğ’‚Â¹(x) = Vec{3}((1.0,0.0,0.0))
# ğ’‚Â²(x) = Vec{3}((0.0,1.0,0.0))
# ğ’‚Â³(x) = Vec{3}((0.0,0.0,1.0))
# Î“Â¹â‚â‚(x) = 0.0
# Î“Â¹â‚â‚‚(x) = 0.0
# Î“Â²â‚‚â‚(x) = 0.0
# Î“Â²â‚‚â‚‚(x) = 0.0

# ğ‘“(x) = 1.0+2.0*x[1]+3.0*x[2] + 4.0*x[1]^2 + 5.0*x[1]*x[2] + 6.0*x[2]^2
# ğ‘“(x) = 1.0
ğ‘“(x) = (x[1]+x[2])^2
function âˆ‚â‚ğ‘“(x)
    x_ = Vec{2}((x[1],x[2]))
    gradient(ğ‘“,x_)
end
function âˆ‚â‚áµ¦ğ‘“(x)
    x_ = Vec{2}((x[1],x[2]))
    gradient(âˆ‚â‚ğ‘“,x_)
end
ğ‘”(x) = (x[1]+x[2])^3
âˆ‚â‚ğ‘”(x) = gradient(ğ‘”,x)

function âˆ‡ğ‘“(x)
    grad = âˆ‚â‚ğ‘“(x)
    x_ = Vec{3}((x[1],x[2],0.0))
    return grad[1]*ğ’‚Â¹(x_) + grad[2]*ğ’‚Â²(x_)
end

ğ‘£áµƒ(x) = Vec{2}((4.0+5.0*x[1]+6.0*x[2],7.0+8.0*x[1]+9.0*x[2]))
# ğ‘£áµƒ(x) = Vec{2}((1.0,0.0))
# Aáµƒáµ‡(x) = SymmetricTensor{2,2}((1.0+2.0*x[1]+3.0*x[2],2.0+3.0*x[1]+4.0*x[2],3.0+4.0*x[1]+5.0*x[2]))
# Aáµƒáµ‡(x) = Tensor{2,2}((1.0*x[1]^1,2.0*x[2]^1,3.0,4.0))
Aáµƒáµ‡(x) = Tensor{2,2}((1.0*x[1]^2,2.0*x[2]^2,2.0*x[2]^2,3.0*x[1]*x[2]))
function âˆ‚Aáµƒáµ‡(x)
    x_ = Vec{2}((x[1],x[2]))
    gradient(Aáµƒáµ‡,x_)
end
function divAáµƒáµ‡(x)
    x_ = Vec{2}((x[1],x[2]))
    gradA = âˆ‚Aáµƒáµ‡(x_)
    return Vec{2}(gradA[:,1,1] + gradA[:,2,2])
end
function âˆ‚â‚áµ¦Aáµƒáµ‡(x)
    x_ = Vec{2}((x[1],x[2]))
    divergence(divAáµƒáµ‡,x_)
end

function ğ’—(x)
    v = ğ‘£áµƒ(x)
    x_ = Vec{3}((x[1],x[2],0.0))
    return v[1]*ğ’‚â‚(x_) + v[2]*ğ’‚â‚‚(x_)
end
ğ‘£áµƒâ‚(x) = divergence(ğ‘£áµƒ,x)
function divğ’—(x)
    x_ = Vec{3}((x[1],x[2],0.0))
    âˆ‡ğ’— = gradient(ğ’—,x_)
    return ğ’‚Â¹(x_)â‹…âˆ‡ğ’—[:,1] + ğ’‚Â²(x_)â‹…âˆ‡ğ’—[:,2]
end

nâ‚(x) = Vec{2}((1/2^0.5,1/2^0.5))
function ğ’(x)
    n = nâ‚(x)
    x_ = Vec{3}((x[1],x[2],0.0))
    return n[1]*ğ’‚Â¹(x_) + n[2]*ğ’‚Â²(x_)
end

function Î“áµáµ§â‚(x)
    x_ = Vec{3}((x[1],x[2],0.0))
    return Vec{2}((Î“Â¹â‚â‚(x_)+Î“Â²â‚‚â‚(x_),Î“Â¹â‚â‚‚(x_)+Î“Â²â‚‚â‚‚(x_)))
end

function Î“áµáµ§áµ¦â‚(x)
    x_ = Vec{3}((x[1],x[2],0.0))
    return Tensor{2,2}((Î“Â¹â‚â‚â‚(x_)+Î“Â²â‚‚â‚â‚(x_),Î“Â¹â‚â‚‚â‚(x_)+Î“Â²â‚‚â‚‚â‚(x_),Î“Â¹â‚â‚â‚‚(x_)+Î“Â²â‚‚â‚â‚‚(x_),Î“Â¹â‚â‚‚â‚‚(x_)+Î“Â²â‚‚â‚‚â‚‚(x_)))
end

x = Vec{2}((rand(),rand()))
x_ = Vec{3}((rand(),rand(),rand()))
(check1 = âˆ‡ğ‘“(x)â‹…ğ’—(x) - âˆ‚â‚ğ‘“(x)â‹…ğ‘£áµƒ(x);check1 â‰ˆ 0.0) ? println("Check 1 right!: $check1") : println("Check 1 wrong: $check1")
(check2 = ğ’—(x)â‹…ğ’(x) - ğ‘£áµƒ(x)â‹…nâ‚(x);check2 â‰ˆ 0.0) ? println("Check 2 right!: $check2") : println("Check 2 wrong: $check2")
(check3 = divğ’—(x) - ğ‘£áµƒâ‚(x) - Î“áµáµ§â‚(x)â‹…ğ‘£áµƒ(x);check3 â‰ˆ 0.0) ? println("Check 3 right!: $check3") : println("Check 3 wrong: $check3")
(check4 = ğ’‚Â¹(x_) - ğ’‚â‚‚(x_)Ã—ğ’‚â‚ƒ(x_)/ğ½(x_);check4 â‰ˆ Vec{3}((0.0,0.0,0.0))) ? println("Check 4 right!: $check4") : println("Check 4 wrong: $check4")
(check5 = ğ’‚Â²(x_) - ğ’‚â‚ƒ(x_)Ã—ğ’‚â‚(x_)/ğ½(x_);check5 â‰ˆ Vec{3}((0.0,0.0,0.0))) ? println("Check 5 right!: $check5") : println("Check 5 wrong: $check5")
(check6 = ğ’‚Â³(x_) - ğ’‚â‚(x_)Ã—ğ’‚â‚‚(x_)/ğ½(x_);check6 â‰ˆ Vec{3}((0.0,0.0,0.0))) ? println("Check 6 right!: $check6") : println("Check 6 wrong: $check6")

err = 0.0
temp1 = 0.0
temp2 = 0.0
for a in elements["Î©"]
    ğ“– = a.ğ“–
    for Î¾ in ğ“–
        ğ‘¤ = Î¾.ğ‘¤
        x_ = Vec{2}((Î¾.x,Î¾.y))
        global err += (âˆ‡ğ‘“(x_)â‹…ğ’—(x_) + ğ‘“(x_)*divğ’—(x_))*ğ‘¤
        # global temp1 += (âˆ‡ğ‘“(x_)â‹…ğ’—(x_) + ğ‘“(x_)*divğ’—(x_))*ğ‘¤
        # println(Î“áµáµ§â‚(x_))
        # global err += (âˆ‡ğ‘“(x_)â‹…ğ’—(x_) + ğ‘“(x_)*ğ‘£áµƒâ‚(x_))*ğ‘¤
        # global temp += ğ‘“(x_)*Î“áµáµ§â‚(x_)â‹…ğ‘£áµƒ(x_)*ğ‘¤
        # println(temp)
        
        # global err += (âˆ‡ğ‘“(x_)â‹…ğ’—(x_) + ğ‘“(x_)*divğ’—(x_))*ğ½(x_)*ğ‘¤
        # println(ğ‘“(x_)*divğ’—(x_))

        # global err += (âˆ‚â‚ğ‘“(x_)[1]*ğ‘”(x_) + ğ‘“(x_)*âˆ‚â‚ğ‘”(x_)[1])*ğ‘¤
        # global err += âˆ‚â‚áµ¦ğ‘“(x_) âŠ¡ Aáµƒáµ‡(x_)*ğ‘¤ - ğ‘“(x_)*(âˆ‚â‚áµ¦Aáµƒáµ‡(x_) + Î“áµáµ§áµ¦â‚(x_) âŠ¡ Aáµƒáµ‡(x_) + 2*Î“áµáµ§â‚(x_) â‹… divAáµƒáµ‡(x_) + (Î“áµáµ§â‚(x_)âŠ—Î“áµáµ§â‚(x_)) âŠ¡ Aáµƒáµ‡(x_))*ğ‘¤
        # global temp1 += âˆ‚â‚áµ¦ğ‘“(x_) âŠ¡ Aáµƒáµ‡(x_)*ğ‘¤ - ğ‘“(x_)*(âˆ‚â‚áµ¦Aáµƒáµ‡(x_) + Î“áµáµ§áµ¦â‚(x_) âŠ¡ Aáµƒáµ‡(x_) + 2*Î“áµáµ§â‚(x_) â‹… divAáµƒáµ‡(x_) + (Î“áµáµ§â‚(x_)âŠ—Î“áµáµ§â‚(x_)) âŠ¡ Aáµƒáµ‡(x_))*ğ‘¤
        # global temp1 -= ğ‘“(x_)*(âˆ‚â‚áµ¦Aáµƒáµ‡(x_) + Î“áµáµ§áµ¦â‚(x_) âŠ¡ Aáµƒáµ‡(x_) + 2*Î“áµáµ§â‚(x_) â‹… divAáµƒáµ‡(x_) + (Î“áµáµ§â‚(x_)âŠ—Î“áµáµ§â‚(x_)) âŠ¡ Aáµƒáµ‡(x_))*ğ‘¤
    end
    # println(temp)
end

for a in elements["Î“"]
    ğ“– = a.ğ“–
    for Î¾ in ğ“–
        ğ‘¤ = Î¾.ğ‘¤
        x_ = Vec{2}((Î¾.x,Î¾.y))
        nâ‚_ = Vec{2}((Î¾.nâ‚,Î¾.nâ‚‚))
        náµƒ_ = Vec{2}((Î¾.nÂ¹,Î¾.nÂ²))
        sâ‚_ = Vec{2}((Î¾.sâ‚,Î¾.sâ‚‚))
        sáµƒ_ = Vec{2}((Î¾.sÂ¹,Î¾.sÂ²))
        # println((Î¾.âˆ‚â‚nâ‚,Î¾.âˆ‚â‚nâ‚‚,Î¾.âˆ‚â‚‚nâ‚,Î¾.âˆ‚â‚‚nâ‚‚))
        âˆ‚áµ¦nâ‚_ = Tensor{2,2}((Î¾.âˆ‚â‚nâ‚,Î¾.âˆ‚â‚nâ‚‚,Î¾.âˆ‚â‚‚nâ‚,Î¾.âˆ‚â‚‚nâ‚‚))
        âˆ‚áµ¦sâ‚_ = Tensor{2,2}((Î¾.âˆ‚â‚sâ‚,Î¾.âˆ‚â‚sâ‚‚,Î¾.âˆ‚â‚‚sâ‚,Î¾.âˆ‚â‚‚sâ‚‚))
        # println(nâ‚_)
        nâ‚ = Î¾.nâ‚
        nâ‚‚ = Î¾.nâ‚‚
        nÂ¹ = Î¾.nÂ¹
        nÂ² = Î¾.nÂ²
        sâ‚ = Î¾.sâ‚
        sâ‚‚ = Î¾.sâ‚‚
        sÂ¹ = Î¾.sÂ¹
        sÂ² = Î¾.sÂ²
        Î” = Î¾.Î”
        n = nâ‚*nÂ¹+nâ‚‚*nÂ²
        s = sâ‚*sÂ¹+sâ‚‚*sÂ²
        # println("n: $n, s: $s")
        global err -= ğ‘“(x_)*ğ‘£áµƒ(x_)â‹…nâ‚_*ğ‘¤
        # global temp2 -= ğ‘“(x_)*ğ‘£áµƒ(x_)â‹…nâ‚_*ğ‘¤
        # global temp2 -= Î¾.nâ‚*ğ‘¤
        # global temp2 -= Î¾.nâ‚‚*ğ‘¤
        # global err -= ğ‘“(x_)*ğ‘”(x_)*nâ‚_[1]*ğ‘¤
        # global err -= âˆ‚â‚ğ‘“(x_)â‹…náµƒ_*nâ‚_â‹…Aáµƒáµ‡(x_)â‹…nâ‚_*ğ‘¤ - ğ‘“(x_)*(sâ‚_â‹…âˆ‚Aáµƒáµ‡(x_) âŠ¡ (nâ‚_âŠ—sáµƒ_) + nâ‚_â‹…Aáµƒáµ‡(x_)â‹…âˆ‚áµ¦sâ‚_â‹…sáµƒ_ + sâ‚_â‹…Aáµƒáµ‡(x_)â‹…âˆ‚áµ¦nâ‚_â‹…sáµƒ_)*ğ‘¤ + Î”*ğ‘“(x_)*sâ‚_â‹…Aáµƒáµ‡(x_)â‹…nâ‚_ - Î“áµáµ§â‚(x_)â‹…Aáµƒáµ‡(x_)â‹…nâ‚_*ğ‘¤
        # global temp2 -= - ğ‘“(x_)*(nâ‚_â‹…Aáµƒáµ‡(x_)â‹…âˆ‚áµ¦sâ‚_â‹…sáµƒ_ + sâ‚_â‹…Aáµƒáµ‡(x_)â‹…âˆ‚áµ¦nâ‚_â‹…sáµƒ_)*ğ‘¤ + Î”*ğ‘“(x_)*sâ‚_â‹…Aáµƒáµ‡(x_)â‹…nâ‚_ - Î“áµáµ§â‚(x_)â‹…Aáµƒáµ‡(x_)â‹…nâ‚_*ğ‘¤
        # global temp2 -= - ğ‘“(x_)*(nâ‚_â‹…Aáµƒáµ‡(x_)â‹…âˆ‚áµ¦sâ‚_â‹…sáµƒ_ + sâ‚_â‹…Aáµƒáµ‡(x_)â‹…âˆ‚áµ¦nâ‚_â‹…sáµƒ_)*ğ‘¤ + Î”*ğ‘“(x_)*sâ‚_â‹…Aáµƒáµ‡(x_)â‹…nâ‚_
    end
end

println(err)
# println(temp2)

temp1 = 0.0
temp2 = 0.0
for a in elements["Î“"]
    ğ“’ = a.ğ“’
    ğ“– = a.ğ“–
    xâ‚ = ğ“’[1].x
    yâ‚ = ğ“’[1].y
    xâ‚‚ = ğ“’[2].x
    yâ‚‚ = ğ“’[2].y
    ğ¿ = ((xâ‚-xâ‚‚)^2 + (yâ‚-yâ‚‚)^2)^0.5
    tÂ¹ = (xâ‚‚-xâ‚)/ğ¿
    tÂ² = (yâ‚‚-yâ‚)/ğ¿
    ğ¿ â‰  a.ğ¿ ? println("ğ¿ wrong!") : nothing
    tâ‚(x) = cs.aâ‚â‚(x)*tÂ¹ + cs.aâ‚â‚‚(x)*tÂ²
    tâ‚‚(x) = cs.aâ‚â‚‚(x)*tÂ¹ + cs.aâ‚‚â‚‚(x)*tÂ²
    t(x) = (tâ‚(x)*tÂ¹ + tâ‚‚(x)*tÂ²)^0.5
    sÂ¹(x) = tÂ¹/t(x)
    sÂ²(x) = tÂ²/t(x)
    sâ‚(x) = tâ‚(x)/t(x)
    sâ‚‚(x) = tâ‚‚(x)/t(x)
    deta(x) = (cs.aâ‚â‚(x)*cs.aâ‚‚â‚‚(x) - cs.aâ‚â‚‚(x)^2)^0.5
    nâ‚(x) = sÂ²(x)*deta(x)
    nâ‚‚(x) =-sÂ¹(x)*deta(x)
    nÂ¹(x) = cs.aÂ¹Â¹(x)*nâ‚(x) + cs.aÂ¹Â²(x)*nâ‚‚(x)
    nÂ²(x) = cs.aÂ¹Â²(x)*nâ‚(x) + cs.aÂ²Â²(x)*nâ‚‚(x)
    âˆ‚â‚nâ‚(x) = gradient(nâ‚,x)[1]
    âˆ‚â‚‚nâ‚(x) = gradient(nâ‚,x)[2]
    âˆ‚â‚nâ‚‚(x) = gradient(nâ‚‚,x)[1]
    âˆ‚â‚‚nâ‚‚(x) = gradient(nâ‚‚,x)[2]
    âˆ‚â‚sâ‚(x) = gradient(sâ‚,x)[1]
    âˆ‚â‚‚sâ‚(x) = gradient(sâ‚,x)[2]
    âˆ‚â‚sâ‚‚(x) = gradient(sâ‚‚,x)[1]
    âˆ‚â‚‚sâ‚‚(x) = gradient(sâ‚‚,x)[2]
    âˆ‚â‚sÂ¹(x) = gradient(sÂ¹,x)[1]
    âˆ‚â‚‚sÂ¹(x) = gradient(sÂ¹,x)[2]
    âˆ‚â‚sÂ²(x) = gradient(sÂ²,x)[1]
    âˆ‚â‚‚sÂ²(x) = gradient(sÂ²,x)[2]
    ğ’â‚(x) = Vec{2}((nâ‚(x),nâ‚‚(x)))
    ğ’áµƒ(x) = Vec{2}((nÂ¹(x),nÂ²(x)))
    ğ’”â‚(x) = Vec{2}((sâ‚(x),sâ‚‚(x)))
    ğ’”áµƒ(x) = Vec{2}((sÂ¹(x),sÂ²(x)))
    Mâ‚›â‚™(x) = ğ’”â‚(x)â‹…Aáµƒáµ‡(x)â‹…ğ’â‚(x)
    âˆ‚Mâ‚›â‚™(x) = gradient(Mâ‚›â‚™,x)[1:2]
    for Î¾ in ğ“–
        ğ‘¤ = Î¾.ğ‘¤
        Î” = Î¾.Î”
        x_ = Vec{3}((Î¾.x,Î¾.y,Î¾.z))
        # check = sâ‚(x_) - Î¾.sâ‚; check â‰‰ 0.0 ? println("sâ‚ wrong! $check") : nothing
        # check = sâ‚‚(x_) - Î¾.sâ‚‚; check â‰‰ 0.0 ? println("sâ‚‚ wrong! $check") : nothing
        # check = nâ‚(x_) - Î¾.nâ‚; check â‰‰ 0.0 ? println("nâ‚ wrong! $check") : nothing
        # check = nâ‚‚(x_) - Î¾.nâ‚‚; check â‰‰ 0.0 ? println("nâ‚‚ wrong! $check") : nothing
        # check = t(x_) - Î¾.t; check â‰‰ 0.0 ? println("t wrong! $check") : nothing
        # check = âˆ‚â‚nâ‚(x_) - Î¾.âˆ‚â‚nâ‚; check â‰‰ 0.0 ? println("âˆ‚â‚nâ‚ wrong! $check") : nothing
        # check = âˆ‚â‚‚nâ‚(x_) - Î¾.âˆ‚â‚‚nâ‚; check â‰‰ 0.0 ? println("âˆ‚â‚‚nâ‚ wrong! $check") : nothing
        # check = âˆ‚â‚nâ‚‚(x_) - Î¾.âˆ‚â‚nâ‚‚; check â‰‰ 0.0 ? println("âˆ‚â‚nâ‚‚ wrong! $check") : nothing
        # check = âˆ‚â‚‚nâ‚‚(x_) - Î¾.âˆ‚â‚‚nâ‚‚; check â‰‰ 0.0 ? println("âˆ‚â‚‚nâ‚‚ wrong! $check") : nothing
        # check = âˆ‚â‚sâ‚(x_) - Î¾.âˆ‚â‚sâ‚; check â‰‰ 0.0 ? println("âˆ‚â‚sâ‚ wrong! $check") : nothing
        # check = âˆ‚â‚‚sâ‚(x_) - Î¾.âˆ‚â‚‚sâ‚; check â‰‰ 0.0 ? println("âˆ‚â‚‚sâ‚ wrong! $check") : nothing
        # check = âˆ‚â‚sâ‚‚(x_) - Î¾.âˆ‚â‚sâ‚‚; check â‰‰ 0.0 ? println("âˆ‚â‚sâ‚‚ wrong! $check") : nothing
        # check = âˆ‚â‚‚sâ‚‚(x_) - Î¾.âˆ‚â‚‚sâ‚‚; check â‰‰ 0.0 ? println("âˆ‚â‚‚sâ‚‚ wrong! $check") : nothing
        # println(gradient(nâ‚,x_))
        # println(Î¾.âˆ‚â‚‚nâ‚)
        âˆ‚ğ’”â‚ = Vec{2}((Î¾.âˆ‚â‚sâ‚*Î¾.sÂ¹ + Î¾.âˆ‚â‚‚sâ‚*Î¾.sÂ²,Î¾.âˆ‚â‚sâ‚‚*Î¾.sÂ¹ + Î¾.âˆ‚â‚‚sâ‚‚*Î¾.sÂ²))
        âˆ‚ğ’â‚ = Vec{2}((Î¾.âˆ‚â‚nâ‚*Î¾.sÂ¹ + Î¾.âˆ‚â‚‚nâ‚*Î¾.sÂ²,Î¾.âˆ‚â‚nâ‚‚*Î¾.sÂ¹ + Î¾.âˆ‚â‚‚nâ‚‚*Î¾.sÂ²))
        # global temp1 += - ğ‘“(x_)*âˆ‚Mâ‚›â‚™(x_)â‹…ğ’”áµƒ(x_)*ğ‘¤ + ğ‘“(x_)*Mâ‚›â‚™(x_)*Î”
        # global temp1 += - ğ‘“(x_)*âˆ‚Mâ‚›â‚™(x_)â‹…ğ’”áµƒ(x_)*ğ‘¤
        # global temp1 += - ğ‘“(x_)*âˆ‚Mâ‚›â‚™(x_)â‹…ğ’”áµƒ(x_)*ğ‘¤ + ğ‘“(x_)*Mâ‚›â‚™(x_)*Î” - ğ‘“(x_)*Î“áµáµ§â‚(x_)â‹…Aáµƒáµ‡(x_)â‹…ğ’â‚(x_)*ğ‘¤
        # global temp1 -= ğ‘“(x_)*Î“áµáµ§â‚(x_)â‹…Aáµƒáµ‡(x_)â‹…ğ’â‚(x_)*ğ‘¤ + ğ‘“(x_)*divAáµƒáµ‡(x_)â‹…ğ’â‚(x_)*ğ‘¤
        # global temp1 += - ğ‘“(x_)*âˆ‚Mâ‚›â‚™(x_)â‹…ğ’”áµƒ(x_)*ğ‘¤ + ğ‘“(x_)*Mâ‚›â‚™(x_)*Î” + âˆ‚â‚ğ‘“(x_)â‹…ğ’áµƒ(x_)*(ğ’â‚(x_)â‹…Aáµƒáµ‡(x_)â‹…ğ’â‚(x_))*ğ‘¤ - ğ‘“(x_)*Î“áµáµ§â‚(x_)â‹…Aáµƒáµ‡(x_)â‹…ğ’â‚(x_)*ğ‘¤ - ğ‘“(x_)*divAáµƒáµ‡(x_)â‹…ğ’â‚(x_)*ğ‘¤
        # println(âˆ‚Aáµƒáµ‡(x_)[:,:,1])
        # println(ğ’”â‚(x_))
        global temp1 += - ğ‘“(x_)*(ğ’”â‚(x_)â‹…(Tensor{2,2}(âˆ‚Aáµƒáµ‡(x_)[:,:,1].*Î¾.sÂ¹+âˆ‚Aáµƒáµ‡(x_)[:,:,2].*Î¾.sÂ²))â‹…ğ’â‚(x_) + âˆ‚ğ’”â‚â‹…Aáµƒáµ‡(x_)â‹…ğ’â‚(x_) + ğ’”â‚(x_)â‹…Aáµƒáµ‡(x_)â‹…âˆ‚ğ’â‚)*ğ‘¤ + ğ‘“(x_)*Mâ‚›â‚™(x_)*Î” + âˆ‚â‚ğ‘“(x_)â‹…ğ’áµƒ(x_)*(ğ’â‚(x_)â‹…Aáµƒáµ‡(x_)â‹…ğ’â‚(x_))*ğ‘¤ - ğ‘“(x_)*Î“áµáµ§â‚(x_)â‹…Aáµƒáµ‡(x_)â‹…ğ’â‚(x_)*ğ‘¤ - ğ‘“(x_)*divAáµƒáµ‡(x_)â‹…ğ’â‚(x_)*ğ‘¤
        # println(âˆ‚Mâ‚›â‚™(x_))
        # println(Aáµƒáµ‡(x_))
        # println(Î”)
        # println(ğ‘“(x_))
        # println(Mâ‚›â‚™(x_))
        # println(ğ‘¤)
        # global temp2 += - ğ‘“(x_)*(âˆ‚ğ’”â‚â‹…Aáµƒáµ‡(x_)â‹…ğ’â‚(x_) + ğ’”â‚(x_)â‹…Aáµƒáµ‡(x_)â‹…âˆ‚ğ’â‚)*ğ‘¤ + ğ‘“(x_)*Mâ‚›â‚™(x_)*Î”
        # global temp2 += ğ‘“(x_)*Mâ‚›â‚™(x_)*Î”
    end
end

for a in elements["Î©"]
    ğ“– = a.ğ“–
    for Î¾ in ğ“–
        ğ‘¤ = Î¾.ğ‘¤
        x_ = Vec{3}((Î¾.x,Î¾.y,Î¾.z))
        # global temp1 += (âˆ‡ğ‘“(x_)â‹…ğ’—(x_) + ğ‘“(x_)*divğ’—(x_))*ğ‘¤
        # println(Î“áµáµ§â‚(x_))
        # global err += (âˆ‡ğ‘“(x_)â‹…ğ’—(x_) + ğ‘“(x_)*ğ‘£áµƒâ‚(x_))*ğ‘¤
        # global temp += ğ‘“(x_)*Î“áµáµ§â‚(x_)â‹…ğ‘£áµƒ(x_)*ğ‘¤
        # println(temp)
        
        # global err += (âˆ‡ğ‘“(x_)â‹…ğ’—(x_) + ğ‘“(x_)*divğ’—(x_))*ğ½(x_)*ğ‘¤
        # println(ğ‘“(x_)*divğ’—(x_))

        # global err += (âˆ‚â‚ğ‘“(x_)[1]*ğ‘”(x_) + ğ‘“(x_)*âˆ‚â‚ğ‘”(x_)[1])*ğ‘¤
        # global err += âˆ‚â‚áµ¦ğ‘“(x_) âŠ¡ Aáµƒáµ‡(x_)*ğ‘¤ - ğ‘“(x_)*(âˆ‚â‚áµ¦Aáµƒáµ‡(x_) + Î“áµáµ§áµ¦â‚(x_) âŠ¡ Aáµƒáµ‡(x_) + 2*Î“áµáµ§â‚(x_) â‹… divAáµƒáµ‡(x_) + (Î“áµáµ§â‚(x_)âŠ—Î“áµáµ§â‚(x_)) âŠ¡ Aáµƒáµ‡(x_))*ğ‘¤
        global temp1 -= âˆ‚â‚áµ¦ğ‘“(x_) âŠ¡ Aáµƒáµ‡(x_)*ğ‘¤
        # println(Î“Â¹â‚â‚â‚(x_))
        # println(Î“Â¹â‚â‚â‚‚(x_))
        # println(Î“Â¹â‚â‚‚â‚(x_))
        # println(Î“Â¹â‚â‚‚â‚‚(x_))
        # println(Î“Â²â‚‚â‚â‚(x_))
        # println(Î“Â²â‚‚â‚â‚‚(x_))
        # println(Î“Â²â‚‚â‚‚â‚(x_))
        # println(Î“Â²â‚‚â‚‚â‚‚(x_))
        # println(temp1)
        global temp1 += ğ‘“(x_)*(Î“áµáµ§â‚(x_)â‹…Aáµƒáµ‡(x_)â‹…Î“áµáµ§â‚(x_) + Î“áµáµ§áµ¦â‚(x_) âŠ¡ Aáµƒáµ‡(x_) + 2*Î“áµáµ§â‚(x_)â‹…divAáµƒáµ‡(x_) + âˆ‚â‚áµ¦Aáµƒáµ‡(x_))*ğ‘¤
        # global temp1 += Î“áµáµ§â‚(x_)â‹…Aáµƒáµ‡(x_)â‹…Î“áµáµ§â‚(x_)*ğ‘¤ + Î“áµáµ§áµ¦â‚(x_) âŠ¡ Aáµƒáµ‡(x_)*ğ‘¤ 
        # global temp2 -= Î“áµáµ§â‚(x_)â‹…Aáµƒáµ‡(x_)â‹…Î“áµáµ§â‚(x_)*ğ‘¤ + Î“áµáµ§áµ¦â‚(x_) âŠ¡ Aáµƒáµ‡(x_)*ğ‘¤ 
        # global temp2 -= Î“áµáµ§â‚(x_)â‹…Aáµƒáµ‡(x_)â‹…Î“áµáµ§â‚(x_)*ğ‘¤
        # global temp2 -=  Î“áµáµ§áµ¦â‚(x_) âŠ¡ Aáµƒáµ‡(x_)*ğ‘¤ 
    end
    # println(temp)
end
println(temp1)
# println(temp2)