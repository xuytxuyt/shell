using Revise
using ApproxOperator, Tensors, BenchmarkExample, LinearAlgebra

include("import_prescrible_ops.jl")
include("import_Spherical_shell.jl")
ndiv = 8
elements, nodes = import_spherical_mix("msh/sphericalshell_"*string(ndiv)*".msh");

nโ = 21
๐ = BenchmarkExample.SphericalShell.๐
E = BenchmarkExample.SphericalShell.๐ธ
ฮฝ = BenchmarkExample.SphericalShell.๐
h = BenchmarkExample.SphericalShell.โ
๐ =  BenchmarkExample.SphericalShell.๐โ
๐น = BenchmarkExample.SphericalShell.๐น

cs = BenchmarkExample.sphericalCoordinate(๐)
nโ = length(nodes)
nแตฅ = Int(length(elements["ฮฉ"])*3)
s = 2.5*๐*๐/(ndiv-1)*ones(nโ)
push!(nodes,:sโ=>s,:sโ=>s,:sโ=>s)

eval(prescribeForMix)
eval(prescribeVariables)

set๐ญ!(elements["ฮฉ"])
setโยฒ๐ญ!(elements["ฮฉโ"])
setโ๐ญ!(elements["ฮโ"])
setโ๐ญ!(elements["ฮฉโ"])
setโ๐ญ!(elements["ฮโ"])
setโ๐ญ!(elements["ฮสณ"])
setโ๐ญ!(elements["ฮหก"])
set๐ญ!(elements["๐ด"])
set๐ญ!(elements["๐ต"])

n = 0
uex(x) = Vec{3}(((x[1]+2*x[2])^n,(3*x[1]+4*x[2])^n,(5*x[1]+6*x[2])^n))
โuex(x) = gradient(uex,x)
โยฒuex(x) = gradient(โuex,x)
dแต = zeros(3*nโ)
dโ = zeros(nโ)
dโ = zeros(nโ)
dโ = zeros(nโ)
for (I,node) in enumerate(nodes)
    x = Vec{3}((node.x,node.y,node.z))
    u = uex(x)
    dแต[3*I-2] = u[1]
    dแต[3*I-1] = u[2]
    dแต[3*I]   = u[3]
    dโ[I] = u[1]
    dโ[I] = u[2]
    dโ[I] = u[3]
end
push!(nodes,:dโ=>dโ,:dโ=>dโ,:dโ=>dโ)

eval(opsMix)

kแตแต = zeros(6*nแตฅ,6*nแตฅ)
kแดบแต = zeros(6*nแตฅ,6*nแตฅ)
kแดบแต = zeros(6*nแตฅ,3*nโ)
kแตแต = zeros(9*nแตฅ,9*nแตฅ)
kแดนแต = zeros(9*nแตฅ,9*nแตฅ)
kแดนแต = zeros(9*nแตฅ,3*nโ)

ops[1](elements["ฮฉ"],kแตแต)
ops[2](elements["ฮฉ"],kแดบแต)
ops[3](elements["ฮโ"],elements["ฮโ"],kแดบแต)
ops[4](elements["ฮฉโ"],elements["ฮฉโ"],kแดบแต)
# ops[3](elements["ฮโ"][1:3],elements["ฮโ"][1:3],kแดบแต)
# ops[4](elements["ฮฉโ"][1:1],elements["ฮฉโ"][1:1],kแดบแต)

ops[5](elements["ฮฉ"],kแตแต)
ops[6](elements["ฮฉ"],kแดนแต)
ops[7](elements["ฮโ"],elements["ฮโ"],kแดนแต)
ops[8](elements["ฮโ"],elements["ฮโ"],kแดนแต)
ops[9](elements["ฮโ"],elements["ฮโ"],kแดนแต)
ops[10](elements["ฮฉโ"],elements["ฮฉโ"],kแดนแต)
# ops[7](elements["ฮโ"][1:3],elements["ฮโ"][1:3],kแดนแต)
# ops[8](elements["ฮโ"][1:3],elements["ฮโ"][1:3],kแดนแต)
# ops[9](elements["ฮโ"][1:3],elements["ฮโ"][1:3],kแดนแต)
# ops[10](elements["ฮฉโ"][1:1],elements["ฮฉโ"][1:1],kแดนแต)

kแต = - kแดบแต\kแดบแต
kแต = - kแดนแต\kแดนแต

fแต = kแต*dแต
fแต = kแต*dแต

err = 0.0
for a in elements["ฮฉโ"]
    ๐ = a.๐
    ๐ = a.๐
    for ฮพ in ๐
        ฮยนโโ = ฮพ.ฮยนโโ
        ฮยฒโโ = ฮพ.ฮยฒโโ
        ฮยนโโ = ฮพ.ฮยนโโ
        ฮยฒโโ = ฮพ.ฮยฒโโ
        ฮยนโโ = ฮพ.ฮยนโโ
        ฮยฒโโ = ฮพ.ฮยฒโโ
        N = ฮพ[:๐ญ]
        x = Vec{3}((ฮพ.x,ฮพ.y,ฮพ.z))
        โโu = โuex(x)[:,1]
        โโu = โuex(x)[:,2]
        โโโu = ฮยนโโ*โuex(x)[:,1] + ฮยฒโโ*โuex(x)[:,2] - โยฒuex(x)[:,1,1]
        โโโu = ฮยนโโ*โuex(x)[:,1] + ฮยฒโโ*โuex(x)[:,2] - โยฒuex(x)[:,2,2]
        โโโu = 2*(ฮยนโโ*โuex(x)[:,1] + ฮยฒโโ*โuex(x)[:,2] - โยฒuex(x)[:,1,2])
        โโuสฐ = zeros(3)
        โโuสฐ = zeros(3)
        โโโuสฐ = zeros(3)
        โโโuสฐ = zeros(3)
        โโโuสฐ = zeros(3)
        for (i,xแตข) in enumerate(๐)
            I = xแตข.๐ผ
            โโuสฐ[1] += N[i]*fแต[6*I-5]
            โโuสฐ[2] += N[i]*fแต[6*I-4]
            โโuสฐ[3] += N[i]*fแต[6*I-4]
            โโuสฐ[1] += N[i]*fแต[6*I-2]
            โโuสฐ[2] += N[i]*fแต[6*I-1]
            โโuสฐ[3] += N[i]*fแต[6*I]

            โโโuสฐ[1] += N[i]*fแต[9*I-8]
            โโโuสฐ[2] += N[i]*fแต[9*I-7]
            โโโuสฐ[3] += N[i]*fแต[9*I-6]
            โโโuสฐ[1] += N[i]*fแต[9*I-5]
            โโโuสฐ[2] += N[i]*fแต[9*I-4]
            โโโuสฐ[3] += N[i]*fแต[9*I-3]
            โโโuสฐ[1] += N[i]*fแต[9*I-2]
            โโโuสฐ[2] += N[i]*fแต[9*I-1]
            โโโuสฐ[3] += N[i]*fแต[9*I]
        end
        # println(โโu[3])
        # println(โโu[3])
        # println(โโuสฐ[1])
        # println(โโuสฐ[1])
        # global err += abs(โโu[3]-โโuสฐ[3])
        # global err += abs(โโu[2]-โโuสฐ[2])
        # global err += abs(โโโu[3]-โโโuสฐ[3])
        # global err += abs(โโโu[3]-โโโuสฐ[3])
        global err += abs(โโโu[2]-โโโuสฐ[2])
    end
end
println(err)

# f1 = zeros(3)
# f2 = zeros(3)
# kt = zeros(3,3)
# f = 0.0
# for a in elements["ฮโ"][1:3]
#     ๐ = a.๐
#     ๐ = a.๐
#     for ฮพ in ๐
#         ๐ค = ฮพ.๐ค
#         nโ = ฮพ.nโ
#         nโ = ฮพ.nโ
#         p = [1.0,ฮพ.x,ฮพ.y]
#         f1 .+= - p*nโ*๐ค
#         f2 .+= - p*nโ*๐ค
#         # global f -= ฮพ.x*nโ*๐ค
#     end
# end
# for a in elements["ฮฉ"][1:1]
#     ๐ = a.๐
#     ๐ = a.๐
#     for ฮพ in ๐
#         ๐ค = ฮพ.๐ค
#         ฮยนโโ = ฮพ.ฮยนโโ
#         ฮยนโโ = ฮพ.ฮยนโโ
#         ฮยนโโ = ฮพ.ฮยนโโ
#         ฮยฒโโ = ฮพ.ฮยฒโโ
#         ฮยฒโโ = ฮพ.ฮยฒโโ
#         ฮยฒโโ = ฮพ.ฮยฒโโ
#         ฮแตแตงโ = ฮยนโโ + ฮยฒโโ
#         ฮแตแตงโ = ฮยนโโ + ฮยฒโโ
#         p = [1.0,ฮพ.x,ฮพ.y]
#         pโ = [0.0,1.0,0.0]
#         pโ = [0.0,0.0,1.0]
#         kt .+= p*p'*๐ค
#         f1 .+= (pโ + ฮแตแตงโ*p)*๐ค
#         f2 .+= (pโ + ฮแตแตงโ*p)*๐ค
#         # global f += ๐ค
#         # global f -= ฮพ.x*(ฮแตแตงโ)*๐ค
#         # global f += ฮพ.w
#         # println(๐ค)
#         println(f1)
#     end
#     # println(a.๐ด)
#     # global f += - a.๐ด
# end

# println(kt\f1)
# println(f)

# f1 = kแดบแต*dแต
# f2 = zeros(6)
# f3 = zeros(6)
f1 = kแดนแต*dแต
f2 = zeros(27)
f3 = zeros(27)
temp = 0.0
for a in elements["ฮโ"][1:3]
# for a in elements["ฮโ"]
    ๐ = a.๐
    ๐ = a.๐
    for ฮพ in ๐
        x_ = Vec{3}((ฮพ.x,ฮพ.y,0.0))
        ๐ค = ฮพ.๐ค
        nโ = ฮพ.nโ
        nโ = ฮพ.nโ
        nยน = ฮพ.nยน
        nยฒ = ฮพ.nยฒ
        sโ = ฮพ.sโ
        sโ = ฮพ.sโ
        sยน = ฮพ.sยน
        sยฒ = ฮพ.sยฒ
        ฮ = ฮพ.ฮ

        โโnโ = ฮพ.โโnโ
        โโnโ = ฮพ.โโnโ
        โโnโ = ฮพ.โโnโ
        โโnโ = ฮพ.โโnโ
        โโsโ = ฮพ.โโsโ
        โโsโ = ฮพ.โโsโ
        โโsโ = ฮพ.โโsโ
        โโsโ = ฮพ.โโsโ
        ฮยนโโ = ฮพ.ฮยนโโ
        ฮยนโโ = ฮพ.ฮยนโโ
        ฮยนโโ = ฮพ.ฮยนโโ
        ฮยฒโโ = ฮพ.ฮยฒโโ
        ฮยฒโโ = ฮพ.ฮยฒโโ
        ฮยฒโโ = ฮพ.ฮยฒโโ
        ฮแตแตงโnโ = ฮยนโโ*nโ + ฮยฒโโ*nโ
        ฮแตแตงโnโ = ฮยนโโ*nโ + ฮยฒโโ*nโ
        ฮแตแตงโnโ = ฮยนโโ*nโ + ฮยฒโโ*nโ
        ฮแตแตงโnโ = ฮยนโโ*nโ + ฮยฒโโ*nโ
        ฮแตโโnแตง = ฮยนโโ*nโ + ฮยฒโโ*nโ
        ฮแตโโnแตง = ฮยนโโ*nโ + ฮยฒโโ*nโ
        ฮแตโโnแตง = ฮยนโโ*nโ + ฮยฒโโ*nโ
        sโnโsยน = sโ*nโ*sยน
        sโnโsยฒ = sโ*nโ*sยฒ
        sโnโsยน = sโ*nโ*sยน
        sโnโsยฒ = sโ*nโ*sยฒ
        sโnโsยน = sโ*nโ*sยน
        sโnโsยฒ = sโ*nโ*sยฒ
        sโnโsยน = sโ*nโ*sยน
        sโnโsยฒ = sโ*nโ*sยฒ
        โแตงsโnโsแต = โโsโ*nโ*sยน + โโsโ*nโ*sยฒ
        โแตงsโnโsแต = โโsโ*nโ*sยน + โโsโ*nโ*sยฒ
        โแตงsโnโsแต = โโsโ*nโ*sยน + โโsโ*nโ*sยฒ
        โแตงsโnโsแต = โโsโ*nโ*sยน + โโsโ*nโ*sยฒ
        sโโแตงnโsแต = sโ*โโnโ*sยน + sโ*โโnโ*sยฒ
        sโโแตงnโsแต = sโ*โโnโ*sยน + sโ*โโnโ*sยฒ
        sโโแตงnโsแต = sโ*โโnโ*sยน + sโ*โโnโ*sยฒ
        sโโแตงnโsแต = sโ*โโnโ*sยน + sโ*โโnโ*sยฒ
        # println(nโ)
        # println(nโ*nยน+nโ*nยฒ)
        p = [1,ฮพ.x,ฮพ.y]
        pโ = [0.0,1.0,0.0]
        pโ = [0.0,0.0,1.0]
        # f2[1:2:6] .-= p.*nโ.*๐ค
        # f2[2:2:6] .-= p.*nโ.*๐ค
        # f2[1:3:9] .-= ((pโ.*sยน+pโ.*sยฒ)*sโ*nโ + (โโsโ*sยน+โโsโ*sยฒ).*p.*nโ + sโ.*p*(โโnโ*sยน+โโnโ*sยฒ) + pโ.*nโ + ฮแตโโnแตง.*p + ฮแตแตงโnโ.*p)*๐ค
        f2[1:9:27] .-= ((pโ.*sยน+pโ.*sยฒ)*sโ*nโ*๐ค + (โโsโ*sยน+โโsโ*sยฒ).*p.*nโ*๐ค + sโ.*p*(โโnโ*sยน+โโnโ*sยฒ)*๐ค + pโ.*nโ*๐ค + ฮแตโโnแตง.*p*๐ค + ฮแตแตงโnโ.*p*๐ค)*uex(x_)[1]
        f2[2:9:27] .-= ((pโ.*sยน+pโ.*sยฒ)*sโ*nโ*๐ค + (โโsโ*sยน+โโsโ*sยฒ).*p.*nโ*๐ค + sโ.*p*(โโnโ*sยน+โโnโ*sยฒ)*๐ค + pโ.*nโ*๐ค + ฮแตโโnแตง.*p*๐ค + ฮแตแตงโnโ.*p*๐ค)*uex(x_)[2]
        f2[3:9:27] .-= ((pโ.*sยน+pโ.*sยฒ)*sโ*nโ*๐ค + (โโsโ*sยน+โโsโ*sยฒ).*p.*nโ*๐ค + sโ.*p*(โโnโ*sยน+โโnโ*sยฒ)*๐ค + pโ.*nโ*๐ค + ฮแตโโnแตง.*p*๐ค + ฮแตแตงโnโ.*p*๐ค)*uex(x_)[3]
        f2[4:9:27] .-= ((pโ.*sยน+pโ.*sยฒ)*sโ*nโ*๐ค + (โโsโ*sยน+โโsโ*sยฒ).*p.*nโ*๐ค + sโ.*p*(โโnโ*sยน+โโnโ*sยฒ)*๐ค + pโ.*nโ*๐ค + ฮแตโโnแตง.*p*๐ค + ฮแตแตงโnโ.*p*๐ค)*uex(x_)[1]
        f2[5:9:27] .-= ((pโ.*sยน+pโ.*sยฒ)*sโ*nโ*๐ค + (โโsโ*sยน+โโsโ*sยฒ).*p.*nโ*๐ค + sโ.*p*(โโnโ*sยน+โโnโ*sยฒ)*๐ค + pโ.*nโ*๐ค + ฮแตโโnแตง.*p*๐ค + ฮแตแตงโnโ.*p*๐ค)*uex(x_)[2]
        f2[6:9:27] .-= ((pโ.*sยน+pโ.*sยฒ)*sโ*nโ*๐ค + (โโsโ*sยน+โโsโ*sยฒ).*p.*nโ*๐ค + sโ.*p*(โโnโ*sยน+โโnโ*sยฒ)*๐ค + pโ.*nโ*๐ค + ฮแตโโnแตง.*p*๐ค + ฮแตแตงโnโ.*p*๐ค)*uex(x_)[3]
        f2[7:9:27] .-= ((pโ.*sยน+pโ.*sยฒ)*(sโ*nโ + sโ*nโ)*๐ค + (โโsโ*sยน+โโsโ*sยฒ).*p.*nโ*๐ค + (โโsโ*sยน+โโsโ*sยฒ).*p.*nโ*๐ค + sโ.*p*(โโnโ*sยน+โโnโ*sยฒ)*๐ค + sโ.*p*(โโnโ*sยน+โโnโ*sยฒ)*๐ค + (pโ.*nโ + pโ.*nโ)*๐ค + 2*ฮแตโโnแตง.*p*๐ค + (ฮแตแตงโnโ+ฮแตแตงโnโ).*p*๐ค)*uex(x_)[1]
        f2[8:9:27] .-= ((pโ.*sยน+pโ.*sยฒ)*(sโ*nโ + sโ*nโ)*๐ค + (โโsโ*sยน+โโsโ*sยฒ).*p.*nโ*๐ค + (โโsโ*sยน+โโsโ*sยฒ).*p.*nโ*๐ค + sโ.*p*(โโnโ*sยน+โโnโ*sยฒ)*๐ค + sโ.*p*(โโnโ*sยน+โโnโ*sยฒ)*๐ค + (pโ.*nโ + pโ.*nโ)*๐ค + 2*ฮแตโโnแตง.*p*๐ค + (ฮแตแตงโnโ+ฮแตแตงโnโ).*p*๐ค)*uex(x_)[2]
        f2[9:9:27] .-= ((pโ.*sยน+pโ.*sยฒ)*(sโ*nโ + sโ*nโ)*๐ค + (โโsโ*sยน+โโsโ*sยฒ).*p.*nโ*๐ค + (โโsโ*sยน+โโsโ*sยฒ).*p.*nโ*๐ค + sโ.*p*(โโnโ*sยน+โโnโ*sยฒ)*๐ค + sโ.*p*(โโnโ*sยน+โโnโ*sยฒ)*๐ค + (pโ.*nโ + pโ.*nโ)*๐ค + 2*ฮแตโโnแตง.*p*๐ค + (ฮแตแตงโnโ+ฮแตแตงโnโ).*p*๐ค)*uex(x_)[3]
        f2[1:9:27] .+= p*nโ*nโ * (โuex(x_)[1,1]*nยน + โuex(x_)[1,2]*nยฒ)*๐ค
        f2[2:9:27] .+= p*nโ*nโ * (โuex(x_)[2,1]*nยน + โuex(x_)[2,2]*nยฒ)*๐ค
        f2[3:9:27] .+= p*nโ*nโ * (โuex(x_)[3,1]*nยน + โuex(x_)[3,2]*nยฒ)*๐ค
        f2[4:9:27] .+= p*nโ*nโ * (โuex(x_)[1,1]*nยน + โuex(x_)[1,2]*nยฒ)*๐ค
        f2[5:9:27] .+= p*nโ*nโ * (โuex(x_)[2,1]*nยน + โuex(x_)[2,2]*nยฒ)*๐ค
        f2[6:9:27] .+= p*nโ*nโ * (โuex(x_)[3,1]*nยน + โuex(x_)[3,2]*nยฒ)*๐ค
        f2[7:9:27] .+= 2*p*nโ*nโ * (โuex(x_)[1,1]*nยน + โuex(x_)[1,2]*nยฒ)*๐ค
        f2[8:9:27] .+= 2*p*nโ*nโ * (โuex(x_)[2,1]*nยน + โuex(x_)[2,2]*nยฒ)*๐ค
        f2[9:9:27] .+= 2*p*nโ*nโ * (โuex(x_)[3,1]*nยน + โuex(x_)[3,2]*nยฒ)*๐ค
        f2[1:9:27] .+= p*sโ*nโ * uex(x_)[1]*ฮ
        f2[2:9:27] .+= p*sโ*nโ * uex(x_)[2]*ฮ
        f2[3:9:27] .+= p*sโ*nโ * uex(x_)[3]*ฮ
        f2[4:9:27] .+= p*sโ*nโ * uex(x_)[1]*ฮ
        f2[5:9:27] .+= p*sโ*nโ * uex(x_)[2]*ฮ
        f2[6:9:27] .+= p*sโ*nโ * uex(x_)[3]*ฮ
        f2[7:9:27] .+= p*(sโ*nโ + sโ*nโ) * uex(x_)[1]*ฮ
        f2[8:9:27] .+= p*(sโ*nโ + sโ*nโ) * uex(x_)[2]*ฮ
        f2[9:9:27] .+= p*(sโ*nโ + sโ*nโ) * uex(x_)[3]*ฮ
    end
end
# println(temp)
for a in elements["ฮฉโ"][1:1]
# for a in elements["ฮฉโ"]
    ๐ = a.๐
    ๐ = a.๐
    for ฮพ in ๐
        x_ = Vec{3}((ฮพ.x,ฮพ.y,0.0))
        ๐ค = ฮพ.๐ค
        ฮยนโโ = ฮพ.ฮยนโโ
        ฮยนโโ = ฮพ.ฮยนโโ
        ฮยนโโ = ฮพ.ฮยนโโ
        ฮยฒโโ = ฮพ.ฮยฒโโ
        ฮยฒโโ = ฮพ.ฮยฒโโ
        ฮยฒโโ = ฮพ.ฮยฒโโ
        ฮยนโโโ = ฮพ.ฮยนโโโ
        ฮยนโโโ = ฮพ.ฮยนโโโ
        ฮยนโโโ = ฮพ.ฮยนโโโ
        ฮยนโโโ = ฮพ.ฮยนโโโ
        ฮยนโโโ = ฮพ.ฮยนโโโ
        ฮยนโโโ = ฮพ.ฮยนโโโ
        ฮยฒโโโ = ฮพ.ฮยฒโโโ
        ฮยฒโโโ = ฮพ.ฮยฒโโโ
        ฮยฒโโโ = ฮพ.ฮยฒโโโ
        ฮยฒโโโ = ฮพ.ฮยฒโโโ
        ฮยฒโโโ = ฮพ.ฮยฒโโโ
        ฮยฒโโโ = ฮพ.ฮยฒโโโ

        ฮแตแตงโโ = ฮยนโโโ+ฮยฒโโโ
        ฮแตแตงโโ = ฮยนโโโ+ฮยฒโโโ
        ฮแตแตงโโ = ฮยนโโโ+ฮยฒโโโ
        ฮแตแตงโโ = ฮยนโโโ+ฮยฒโโโ
        ฮแตโโแตง = ฮยนโโโ+ฮยฒโโโ
        ฮแตโโแตง = ฮยนโโโ+ฮยฒโโโ
        ฮแตโโแตง = ฮยนโโโ+ฮยฒโโโ

        ฮแตแตงโ = ฮยนโโ+ฮยฒโโ
        ฮแตแตงโ = ฮยนโโ+ฮยฒโโ
        ฮแตแตงโฮแตแตฆโ = ฮแตแตงโ^2
        ฮแตแตงโฮแตแตฆโ = ฮแตแตงโ^2
        ฮแตแตงโฮแตแตฆโ = ฮแตแตงโ*ฮแตแตงโ
        ฮแตแตงโฮแตแตฆโ = ฮแตแตงโ*ฮแตแตงโ
        ฮแตแตงแตฆฮแตโโ = ฮแตแตงโ*ฮยนโโ + ฮแตแตงโ*ฮยฒโโ
        ฮแตแตงแตฆฮแตโโ = ฮแตแตงโ*ฮยนโโ + ฮแตแตงโ*ฮยฒโโ
        ฮแตแตงแตฆฮแตโโ = ฮแตแตงโ*ฮยนโโ + ฮแตแตงโ*ฮยฒโโ


        p = [1,ฮพ.x,ฮพ.y]
        pโ = [0.0,1.0,0.0]
        pโ = [0.0,0.0,1.0]
        # f2[1:2:6] .+= (pโ + ฮแตแตงโ.*p)*๐ค
        # f2[2:2:6] .+= (pโ + ฮแตแตงโ.*p)*๐ค
        # f2[1:2:6] .+= pโ*๐ค
        # f2[2:2:6] .+= pโ*๐ค
        # println(ฮแตโโแตง*p)
        # println(ฮยนโโ*pโ+ฮยฒโโ*pโ)
        f3[1:9:27] .+= (ฮแตโโแตง*p + (ฮยนโโ*pโ+ฮยฒโโ*pโ) + ฮแตแตงแตฆฮแตโโ*p + ฮแตแตงโโ*p + 2*ฮแตแตงโ*pโ + ฮแตแตงโฮแตแตฆโ*p)*uex(x_)[1]*๐ค
        f3[2:9:27] .+= (ฮแตโโแตง*p + (ฮยนโโ*pโ+ฮยฒโโ*pโ) + ฮแตแตงแตฆฮแตโโ*p + ฮแตแตงโโ*p + 2*ฮแตแตงโ*pโ + ฮแตแตงโฮแตแตฆโ*p)*uex(x_)[2]*๐ค
        f3[3:9:27] .+= (ฮแตโโแตง*p + (ฮยนโโ*pโ+ฮยฒโโ*pโ) + ฮแตแตงแตฆฮแตโโ*p + ฮแตแตงโโ*p + 2*ฮแตแตงโ*pโ + ฮแตแตงโฮแตแตฆโ*p)*uex(x_)[3]*๐ค
        f3[4:9:27] .+= (ฮแตโโแตง*p + (ฮยนโโ*pโ+ฮยฒโโ*pโ) + ฮแตแตงแตฆฮแตโโ*p + ฮแตแตงโโ*p + 2*ฮแตแตงโ*pโ + ฮแตแตงโฮแตแตฆโ*p)*uex(x_)[1]*๐ค
        f3[5:9:27] .+= (ฮแตโโแตง*p + (ฮยนโโ*pโ+ฮยฒโโ*pโ) + ฮแตแตงแตฆฮแตโโ*p + ฮแตแตงโโ*p + 2*ฮแตแตงโ*pโ + ฮแตแตงโฮแตแตฆโ*p)*uex(x_)[2]*๐ค
        f3[6:9:27] .+= (ฮแตโโแตง*p + (ฮยนโโ*pโ+ฮยฒโโ*pโ) + ฮแตแตงแตฆฮแตโโ*p + ฮแตแตงโโ*p + 2*ฮแตแตงโ*pโ + ฮแตแตงโฮแตแตฆโ*p)*uex(x_)[3]*๐ค
        f3[7:9:27] .+= (2*ฮแตโโแตง*p + 2*(ฮยนโโ*pโ+ฮยฒโโ*pโ) + 2*ฮแตแตงแตฆฮแตโโ*p + (ฮแตแตงโโ + ฮแตแตงโโ)*p + 2*(ฮแตแตงโ*pโ + ฮแตแตงโ*pโ) + 2*ฮแตแตงโฮแตแตฆโ*p)*uex(x_)[1]*๐ค
        f3[8:9:27] .+= (2*ฮแตโโแตง*p + 2*(ฮยนโโ*pโ+ฮยฒโโ*pโ) + 2*ฮแตแตงแตฆฮแตโโ*p + (ฮแตแตงโโ + ฮแตแตงโโ)*p + 2*(ฮแตแตงโ*pโ + ฮแตแตงโ*pโ) + 2*ฮแตแตงโฮแตแตฆโ*p)*uex(x_)[2]*๐ค
        f3[9:9:27] .+= (2*ฮแตโโแตง*p + 2*(ฮยนโโ*pโ+ฮยฒโโ*pโ) + 2*ฮแตแตงแตฆฮแตโโ*p + (ฮแตแตงโโ + ฮแตแตงโโ)*p + 2*(ฮแตแตงโ*pโ + ฮแตแตงโ*pโ) + 2*ฮแตแตงโฮแตแตฆโ*p)*uex(x_)[3]*๐ค
        # f3[1:3:9] .+= ((ฮยฒโโ*pโ+ฮยนโโ*pโ))*uex(x_)[1]*๐ค
        # f3[1:3:9] .+= (ฮแตโโแตง*p)*uex(x_)[1]*๐ค
    end
end
# println(norm(f1[1:27]-f2))
println(f2)
println(f3)
# println(norm(f1[1:27]-f3))
println(norm(f2+f3))